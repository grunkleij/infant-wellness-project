{% extends 'predictor/base.html' %}

{% block title %}Prediction History{% endblock %}

{% block content %}
<div class="card p-4 p-md-5">
    <h1 class="text-center mb-4">Prediction History ðŸ“œ</h1>

    {% if not predictions %}
    <div class="alert alert-info text-center" role="alert">
        No predictions have been made yet. Go to the predictor to create one!
    </div>
    {% else %}
    <div class="accordion" id="predictionAccordion">
        {% for record in predictions %}
        <div class="accordion-item">
            <h2 class="accordion-header" id="heading-{{ record.id }}">
                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                    data-bs-target="#collapse-{{ record.id }}">
                    <strong>Risk: {{ record.prediction|upper }}</strong> &nbsp;
                     <!-- ({{ record.prediction_proba }}%)  -->
                     {{ record.created_at|date:"F j, Y, P a" }}

                </button>
            </h2>
            <div id="collapse-{{ record.id }}" class="accordion-collapse collapse"
                data-bs-parent="#predictionAccordion">
                <div class="accordion-body">
                    <div class="row">
                        <div class="col-md-6">
                            <h5>Birth Details</h5>
                            <ul>
                                <li><strong>Gestational Age:</strong> {{ record.gestational_age_weeks }} weeks</li>
                                <li><strong>Birth Weight:</strong> {{ record.birth_weight_kg }} kg</li>
                                <li><strong>Birth Length:</strong> {{ record.birth_length_cm }} cm</li>
                                <li><strong>Apgar Score:</strong> {{ record.apgar_score }}</li>
                            </ul>
                        </div>
                        <div class="col-md-6">
                            <h5>Details at Prediction (Day {{ record.age_days }})</h5>
                            <ul>
                                <li><strong>Current Weight:</strong> {{ record.weight_kg }} kg</li>
                                <li><strong>Current Length:</strong> {{ record.length_cm }} cm</li>
                                <li><strong>Temperature:</strong> {{ record.temperature_c }} Â°C</li>
                                <li><strong>Heart Rate:</strong> {{ record.heart_rate_bpm }} bpm</li>
                            </ul>
                            
                            <div class="text-end mt-3">
                                <form action="{% url 'delete_prediction' record.id %}" method="post">
                                    {% csrf_token %}
                                    <button type="submit" class="btn btn-danger btn-sm"
                                        onclick="return confirm('Are you sure you want to delete this prediction?');">
                                        Delete Record
                                    </button>
                                </form>
                            </div>

                        </div>
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
    {% endif %}
</div>
{% endblock %}